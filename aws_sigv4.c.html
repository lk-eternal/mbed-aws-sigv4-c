<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style type="text/css">
<!--
table {margin: 0; border: 1px solid #a0a0a0; box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15);}
td,th {word-break: break-all; font-size: 12pt;padding: 0 3px;}
tr { vertical-align: top; }
.ln {text-align: right; word-break: normal; background-color: lightgrey;}
.title {color: white; background-color: blue; vertical-align: top; padding: 4px 4px; background: linear-gradient(mediumblue, darkblue);}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #0078d7; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf3b18 {color: #000000; background-color: #ffaa82; }
.sf3b19 {color: #000000; background-color: #c8816c; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #0078d7; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf6b18 {color: #ffffff; background-color: #ffaa82; }
.sf6b19 {color: #ffffff; background-color: #c8816c; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #0078d7; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf7b18 {color: #0000ff; background-color: #ffaa82; font-weight: bold; }
.sf7b19 {color: #0000ff; background-color: #c8816c; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #0078d7; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf8b18 {color: #800080; background-color: #ffaa82; }
.sf8b19 {color: #800080; background-color: #c8816c; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #0078d7; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf9b18 {color: #008000; background-color: #ffaa82; }
.sf9b19 {color: #008000; background-color: #c8816c; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #0078d7; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf10b18 {color: #ff0000; background-color: #ffaa82; }
.sf10b19 {color: #ff0000; background-color: #c8816c; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #0078d7; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf11b18 {color: #606060; background-color: #ffaa82; }
.sf11b19 {color: #606060; background-color: #c8816c; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #0078d7; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf12b18 {color: #800000; background-color: #ffaa82; }
.sf12b19 {color: #800000; background-color: #c8816c; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #0078d7; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf13b18 {color: #0080c0; background-color: #ffaa82; }
.sf13b19 {color: #0080c0; background-color: #c8816c; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #0078d7; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf15b18 {color: #000000; background-color: #ffaa82; }
.sf15b19 {color: #000000; background-color: #c8816c; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #0078d7; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf17b18 {color: #000000; background-color: #ffaa82; }
.sf17b19 {color: #000000; background-color: #c8816c; }
.sf20b2 {color: #000080; background-color: #ffffff; }
.sf20b5 {color: #000080; background-color: #0078d7; }
.sf20b14 {color: #000080; background-color: #ffa0a0; }
.sf20b16 {color: #000080; background-color: #f1e2ad; }
.sf20b18 {color: #000080; background-color: #ffaa82; }
.sf20b19 {color: #000080; background-color: #c8816c; }
.sf21b2 {color: #0080c0; background-color: #ffffff; }
.sf21b5 {color: #0080c0; background-color: #0078d7; }
.sf21b14 {color: #0080c0; background-color: #ffa0a0; }
.sf21b16 {color: #0080c0; background-color: #f1e2ad; }
.sf21b18 {color: #0080c0; background-color: #ffaa82; }
.sf21b19 {color: #0080c0; background-color: #c8816c; }
-->
</style>
</head>
<body>
<table cellspacing="0" cellpadding="0" style="width:100%;">
<thead>
<tr>
<th colspan="2" class="title" style="width:50.000000%">aws_sigv4.c<br>変更前</th>
<th colspan="2" class="title" style="width:50.000000%">aws_sigv4.c<br>変更後</th>
</tr>
</thead>
<tbody>
<tr>
<td class="ln">1</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;string.h&gt;</span></code></td>
<td class="ln">1</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;string.h&gt;</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d1" href="#d1">2</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#include </span><span class="sf17b16">&lt;openssl</span><span style="color: #000000; background-color: #efcb05; ">/sha</span><span style="color: #000000; background-color: #efcb05; ">.h</span><span class="sf17b16">&gt;</span>&nbsp;</code></td>
<td class="ln">2</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#include </span><span class="sf17b16">"mbedtls</span><span style="color: #000000; background-color: #efcb05; ">/sha</span><span class="sf17b18">256</span><span style="color: #000000; background-color: #efcb05; ">.h</span><span class="sf17b16">"</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">3</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#include </span><span class="sf17b16">&lt;openssl</span><span style="color: #000000; background-color: #efcb05; ">/</span><span class="sf17b16">hmac</span><span style="color: #000000; background-color: #efcb05; ">.h</span><span class="sf17b16">&gt;</span>&nbsp;</code></td>
<td class="ln">3</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#include </span><span class="sf17b16">"mbedtls</span><span style="color: #000000; background-color: #efcb05; ">/</span><span class="sf17b16">md_internal</span><span style="color: #000000; background-color: #efcb05; ">.h</span><span class="sf17b16">"</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf13b2">#include "aws_sigv4.h"</span></code></td>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf13b2">#include "aws_sigv4.h"</span></code></td>
</tr>
<tr>
<td class="ln">5</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">5</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d2" href="#d2">.</a></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">6</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#define SHA256_DIGEST_LENGTH &nbsp; 32</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">7</td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">6</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_AUTH_HEADER_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"Authorization"</span></code></td>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_AUTH_HEADER_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"Authorization"</span></code></td>
</tr>
<tr>
<td class="ln">7</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_SIGNING_ALGORITHM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "AWS4-HMAC-SHA256"</span></code></td>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_SIGNING_ALGORITHM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "AWS4-HMAC-SHA256"</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d3" href="#d3">8</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#define AWS_SIGV4_HEX_SHA256_LENGTH &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SHA256_DIGEST_LENGTH * 2</span></code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_AUTH_HEADER_MAX_LEN &nbsp; &nbsp; &nbsp; &nbsp; 1024</span></code></td>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_AUTH_HEADER_MAX_LEN &nbsp; &nbsp; &nbsp; &nbsp; 1024</span></code></td>
</tr>
<tr>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_CANONICAL_REQUEST_BUF_LEN &nbsp; 1024</span></code></td>
<td class="ln">11</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_CANONICAL_REQUEST_BUF_LEN &nbsp; 1024</span></code></td>
</tr>
<tr>
<td class="ln">11</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_STRING_TO_SIGN_BUF_LEN &nbsp; &nbsp; &nbsp;1024</span></code></td>
<td class="ln">12</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_STRING_TO_SIGN_BUF_LEN &nbsp; &nbsp; &nbsp;1024</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d4" href="#d4">12</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#define AWS_SIGV4_KEY_BUF_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">3</span><span style="color: #000000; background-color: #efcb05; ">3</span></code></td>
<td class="ln">13</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">#define AWS_SIGV4_KEY_BUF_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">44 &nbsp;//aws_secret_access_key is 40 + AWS</span><span style="color: #000000; background-color: #efcb05; ">3</span></code></td>
</tr>
<tr>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_MAX_NUM_QUERY_COMPONENTS &nbsp; &nbsp;50</span></code></td>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf13b2">#define AWS_SIGV4_MAX_NUM_QUERY_COMPONENTS &nbsp; &nbsp;50</span></code></td>
</tr>
<tr>
<td class="ln">14</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">15</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf7b2">typedef</span><span class="sf11b2"> </span><span class="sf7b2">int</span><span class="sf11b2"> (*</span><span class="sf3b2">aws_sigv4_compare_func_t</span><span class="sf11b2">)(</span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2">*, </span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2">*);</span></code></td>
<td class="ln">16</td><td class="sf3b2"><code><span class="sf7b2">typedef</span><span class="sf11b2"> </span><span class="sf7b2">int</span><span class="sf11b2"> (*</span><span class="sf3b2">aws_sigv4_compare_func_t</span><span class="sf11b2">)(</span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2">*, </span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2">*);</span></code></td>
</tr>
<tr>
<td class="ln">16</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">17</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_kv_cmp</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">p1</span><span class="sf11b2">,</span></code></td>
<td class="ln">18</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_kv_cmp</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">p1</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">18</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">p2</span><span class="sf11b2">)</span></code></td>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">p2</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &lt;= </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> ? </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> : </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">21</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &lt;= </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> ? </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> : </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">21</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf8b2">strncmp</span><span class="sf11b2">((</span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, (</span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">len</span><span class="sf11b2">);</span></code></td>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf8b2">strncmp</span><span class="sf11b2">((</span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">p1</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, (</span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">p2</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">len</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">23</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">23</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">24</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf8b2">construct_query_str</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp;</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">,</span></code></td>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf8b2">construct_query_str</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp;</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">query_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">26</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* </span><span class="sf3b2">query_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">26</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_num</span><span class="sf11b2">)</span></code></td>
<td class="ln">27</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_num</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">27</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">for</span><span class="sf11b2"> (</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">i</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2"> &lt; </span><span class="sf3b2">query_num</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++)</span></code></td>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">for</span><span class="sf11b2"> (</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">i</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2"> &lt; </span><span class="sf3b2">query_num</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++)</span></code></td>
</tr>
<tr>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf9b2">/* here we assume args are percent-encoded */</span>&nbsp;</code></td>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf9b2">/* here we assume args are percent-encoded */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">dst_cstr</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">, </span><span class="sf12b2">"%V=%V"</span><span class="sf11b2">,</span></code></td>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">dst_cstr</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">, </span><span class="sf12b2">"%V=%V"</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">, &amp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">);</span></code></td>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">, &amp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">i</span><span class="sf11b2"> != </span><span class="sf3b2">query_num</span><span class="sf11b2"> - </span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln">34</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">i</span><span class="sf11b2"> != </span><span class="sf3b2">query_num</span><span class="sf11b2"> - </span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">34</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
<td class="ln">35</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">35</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;*(</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">++) = </span><span class="sf12b2">'&amp;'</span><span class="sf11b2">;</span></code></td>
<td class="ln">36</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;*(</span><span class="sf3b2">dst_cstr</span><span class="sf11b2">++) = </span><span class="sf12b2">'&amp;'</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">36</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">37</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">37</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">dst_cstr</span><span class="sf11b2">;</span></code></td>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">dst_cstr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">40</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">41</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">parse_query_params</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">query_str</span><span class="sf11b2">,</span></code></td>
<td class="ln">42</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">parse_query_params</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">query_str</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">42</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">* &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">size_t</span><span class="sf11b2">* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">arr_len</span><span class="sf11b2">)</span></code></td>
<td class="ln">44</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">size_t</span><span class="sf11b2">* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">arr_len</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">44</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(</span><span class="sf3b2">query_str</span><span class="sf11b2">)</span></code></td>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(</span><span class="sf3b2">query_str</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf3b2">query_params</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
<td class="ln">47</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf3b2">query_params</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">47</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">48</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">48</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">arr_len</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">arr_len</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2">;</span></code></td>
<td class="ln">50</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">50</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">idx</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">52</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">idx</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">52</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> = </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> = </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* here we assume query string are well-formed */</span>&nbsp;</code></td>
<td class="ln">55</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* here we assume query string are well-formed */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">55</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">while</span><span class="sf11b2"> (</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> != </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2"> + </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2">)</span></code></td>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">while</span><span class="sf11b2"> (</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> != </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2"> + </span><span class="sf3b2">query_str</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (*</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> == </span><span class="sf12b2">'='</span><span class="sf11b2">)</span></code></td>
<td class="ln">58</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (*</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> == </span><span class="sf12b2">'='</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">58</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; &nbsp; = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; &nbsp; = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= ++</span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= ++</span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">62</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">62</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf11b2"> </span><span class="sf7b2">if</span><span class="sf11b2"> (*</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> == </span><span class="sf12b2">'&amp;'</span><span class="sf11b2">)</span></code></td>
<td class="ln">63</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span><span class="sf11b2"> </span><span class="sf7b2">if</span><span class="sf11b2"> (*</span><span class="sf3b2">c_ptr</span><span class="sf11b2"> == </span><span class="sf12b2">'&amp;'</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">63</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[++</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= ++</span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[++</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= ++</span><span class="sf3b2">c_ptr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span></code></td>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">else</span></code></td>
</tr>
<tr>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++;</span></code></td>
<td class="ln">70</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++;</span></code></td>
</tr>
<tr>
<td class="ln">70</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">72</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">72</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> - </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">idx</span><span class="sf11b2">].</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*</span><span class="sf3b2">arr_len</span><span class="sf11b2"> = </span><span class="sf3b2">idx</span><span class="sf11b2"> + </span><span class="sf10b2">1</span><span class="sf11b2">;</span></code></td>
<td class="ln">74</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*</span><span class="sf3b2">arr_len</span><span class="sf11b2"> = </span><span class="sf3b2">idx</span><span class="sf11b2"> + </span><span class="sf10b2">1</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">74</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">75</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">75</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">76</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">76</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">str_in</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">hex_out</span><span class="sf11b2">)</span></code></td>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">str_in</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">hex_out</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">78</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">78</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">digits</span><span class="sf11b2">[] = </span><span class="sf12b2">"0123456789abcdef"</span><span class="sf11b2">;</span></code></td>
<td class="ln">79</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">static</span><span class="sf11b2"> </span><span class="sf7b2">const</span><span class="sf11b2"> </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">digits</span><span class="sf11b2">[] = </span><span class="sf12b2">"0123456789abcdef"</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">79</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> = </span><span class="sf3b2">hex_out</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">c_ptr</span><span class="sf11b2"> = </span><span class="sf3b2">hex_out</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">for</span><span class="sf11b2"> (</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">i</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2"> &lt; </span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++)</span></code></td>
<td class="ln">81</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">for</span><span class="sf11b2"> (</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">i</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2"> &lt; </span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++)</span></code></td>
</tr>
<tr>
<td class="ln">81</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">82</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">82</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*(</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++) = </span><span class="sf3b2">digits</span><span class="sf11b2">[(</span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">] &amp; </span><span class="sf10b2">0xf0</span><span class="sf11b2">) &gt;&gt; </span><span class="sf10b2">4</span><span class="sf11b2">];</span></code></td>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*(</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++) = </span><span class="sf3b2">digits</span><span class="sf11b2">[(</span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">] &amp; </span><span class="sf10b2">0xf0</span><span class="sf11b2">) &gt;&gt; </span><span class="sf10b2">4</span><span class="sf11b2">];</span></code></td>
</tr>
<tr>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*(</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++) = </span><span class="sf3b2">digits</span><span class="sf11b2">[</span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">] &amp; </span><span class="sf10b2">0x0f</span><span class="sf11b2">];</span></code></td>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*(</span><span class="sf3b2">c_ptr</span><span class="sf11b2">++) = </span><span class="sf3b2">digits</span><span class="sf11b2">[</span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">] &amp; </span><span class="sf10b2">0x0f</span><span class="sf11b2">];</span></code></td>
</tr>
<tr>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">hex_out</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> * </span><span class="sf10b2">2</span><span class="sf11b2">;</span></code></td>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">hex_out</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str_in</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> * </span><span class="sf10b2">2</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">87</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">88</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">88</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_hex_sha256</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">str_in</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">hex_sha256_out</span><span class="sf11b2">)</span></code></td>
<td class="ln">89</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_hex_sha256</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">str_in</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">hex_sha256_out</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">89</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">sha256_buf</span><span class="sf11b2">[</span><span class="sf3b2">SHA256_DIGEST_LENGTH</span><span class="sf11b2">];</span></code></td>
<td class="ln">91</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">sha256_buf</span><span class="sf11b2">[</span><span class="sf3b2">SHA256_DIGEST_LENGTH</span><span class="sf11b2">];</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d5" href="#d5">91</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">SHA256_CTX</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">92</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_sha256_context</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">92</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">SHA256_I</span><span style="color: #000000; background-color: #efcb05; ">nit</span><span style="color: #000000; background-color: #efcb05; ">(&amp;</span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">93</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_sha256_i</span><span style="color: #000000; background-color: #efcb05; ">nit</span><span style="color: #000000; background-color: #efcb05; ">(&amp;</span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">93</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">SHA256_Update</span><span style="color: #000000; background-color: #efcb05; ">(&amp;</span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">str_in</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">str_in</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">94</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_sha256_starts</span><span style="color: #000000; background-color: #efcb05; ">(&amp;</span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b18">0);</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">94</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">SHA256_Final</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">sha256_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">&amp;ctx</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">95</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;mbedtls_sha256_update(&amp;ctx, </span><span style="color: #000000; background-color: #efcb05; ">str_in</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">str_in</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">96</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_sha256_finish</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;ctx</span><span style="color: #000000; background-color: #efcb05; ">, </span><span class="sf17b16">sha256_buf</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">95</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">97</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">sha256_str</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">sha256_buf</span><span class="sf11b2">, .</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">SHA256_DIGEST_LENGTH</span><span class="sf11b2"> };</span></code></td>
<td class="ln">98</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">sha256_str</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">sha256_buf</span><span class="sf11b2">, .</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">SHA256_DIGEST_LENGTH</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sha256_str</span><span class="sf11b2">, </span><span class="sf3b2">hex_sha256_out</span><span class="sf11b2">);</span></code></td>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sha256_str</span><span class="sf11b2">, </span><span class="sf3b2">hex_sha256_out</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d6" href="#d6">.</a></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">100</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">mbedtls_sha256_free</span><span style="color: #000000; background-color: #efcb05; ">(&amp;</span><span style="color: #000000; background-color: #efcb05; ">ctx</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">98</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">99</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">102</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_signing_key</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">signing_key</span><span class="sf11b2">)</span></code></td>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_signing_key</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">signing_key</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">key_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_KEY_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
<td class="ln">105</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">key_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_KEY_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">msg_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_KEY_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
<td class="ln">106</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">msg_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_KEY_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">key</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">key_buf</span><span class="sf11b2"> };</span></code></td>
<td class="ln">107</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">key</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">key_buf</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">105</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">msg</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">msg_buf</span><span class="sf11b2"> };</span></code></td>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">msg</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">msg_buf</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">106</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kDate = HMAC("AWS4" + kSecret, Date) */</span>&nbsp;</code></td>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kDate = HMAC("AWS4" + kSecret, Date) */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d7" href="#d7">107</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">key_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"AWS4%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span class="sf17b16">key_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">110</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">key.data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"AWS4%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span class="sf17b16">key.data</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* data in YYYYMMDD format */</span>&nbsp;</code></td>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* data in YYYYMMDD format */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d8" href="#d8">109</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_snprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">msg_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">8</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">x_amz_date</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span class="sf17b16">msg_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">112</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_snprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">msg.data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">8</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">x_amz_date</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span class="sf17b16">msg.data</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">110</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get HMAC SHA256 */</span>&nbsp;</code></td>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get HMAC SHA256 */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d9" href="#d9">111</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">HMAC</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">EVP_sha256()</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">114</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_md_hmac</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;mbedtls_sha256_info</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln">112</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span class="sf17b18">, (unsigned int *</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18"> &amp;signing_key-&gt;len)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">115</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kRegion = HMAC(kDate, Region) */</span>&nbsp;</code></td>
<td class="ln">116</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kRegion = HMAC(kDate, Region) */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d10" href="#d10">114</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">len = aws_sigv4_sprintf(key_buf</span><span style="color: #000000; background-color: #efcb05; ">,</span><span class="sf17b18"> "%V", </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">-</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">key_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">117</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b18">memcpy(</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">data</span><span style="color: #000000; background-color: #efcb05; ">,</span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span class="sf17b18">-&gt;data,mbedt<wbr>ls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">;</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">115</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">118</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;key.len</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">=</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">mbedtls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">116</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">HMAC</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">EVP_sha256()</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">119</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">117</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span class="sf17b18">, (unsigned int *</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18"> &amp;signing_key-&gt;len)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">120</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_md_hmac</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;mbedtls_sha256_info</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">121</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">118</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kService = HMAC(kRegion, Service) */</span>&nbsp;</code></td>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kService = HMAC(kRegion, Service) */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d11" href="#d11">119</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">len = aws_sigv4_sprintf(key_buf</span><span style="color: #000000; background-color: #efcb05; ">,</span><span class="sf17b18"> "%V", </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">-</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">key_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">123</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b18">memcpy(</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">data</span><span style="color: #000000; background-color: #efcb05; ">,</span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span class="sf17b18">-&gt;data,mbedt<wbr>ls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">;</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">120</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">124</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;key.len</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">=</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">mbedtls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">121</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">HMAC</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">EVP_sha256()</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">125</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"%V"</span><span style="color: #000000; background-color: #efcb05; ">, &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">122</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span class="sf17b18">, (unsigned int *</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18"> &amp;signing_key-&gt;len)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">126</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_md_hmac</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;mbedtls_sha256_info</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">127</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">123</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kSigning = HMAC(kService, "aws4_request") */</span>&nbsp;</code></td>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* kSigning = HMAC(kService, "aws4_request") */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d12" href="#d12">124</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">len = aws_sigv4_sprintf(key_buf</span><span style="color: #000000; background-color: #efcb05; ">,</span><span class="sf17b18"> "%V", </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">-</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">key_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">129</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b18">memcpy(</span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">data</span><span style="color: #000000; background-color: #efcb05; ">,</span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span class="sf17b18">-&gt;data,mbedt<wbr>ls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">;</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">125</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"aws4_request"</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">_buf</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">130</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;key.len</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">=</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">mbedtls_sha256_info.size</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">126</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">HMAC</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">EVP_sha256()</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">131</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">"aws4_request"</span><span style="color: #000000; background-color: #efcb05; ">) - </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span class="sf17b16">.data</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">127</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span class="sf17b18">, (unsigned int *</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18"> &amp;signing_key-&gt;len)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">132</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_md_hmac</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;mbedtls_sha256_info</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">key</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">133</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">134</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">129</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">135</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_credential_scope</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t<wbr></span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_credential_scope</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t<wbr></span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">131</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">credential_scope</span><span class="sf11b2">)</span></code></td>
<td class="ln">137</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">credential_scope</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">132</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">139</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">134</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get date in yyyymmdd format */</span>&nbsp;</code></td>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get date in yyyymmdd format */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_snprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf10b2">8</span><span class="sf11b2">, </span><span class="sf12b2">"%V"</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_amz_date</span><span class="sf11b2">);</span></code></td>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_snprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf10b2">8</span><span class="sf11b2">, </span><span class="sf12b2">"%V"</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_amz_date</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"/%V/%V/aws4_request"</span><span class="sf11b2">,</span></code></td>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"/%V/%V/aws4_request"</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">137</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">region</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">service</span><span class="sf11b2">);</span></code></td>
<td class="ln">143</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">region</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">service</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">credential_scope</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">139</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">140</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">146</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">147</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">signed_headers</span><span class="sf11b2">)</span></code></td>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">signed_headers</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">143</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Need to support additional headers and header sorting */</span>&nbsp;</code></td>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Need to support additional headers and header sorting */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d13" href="#d13">145</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">signed_headers</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">signed_headers</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">,<wbr> </span><span style="color: #000000; background-color: #efcb05; ">"host;x-amz-</span><span style="color: #000000; background-color: #efcb05; ">date</span><span style="color: #000000; background-color: #efcb05; ">"</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
<td class="ln">151</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">signed_headers</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">len</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_sprintf</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">signed_headers</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">,<wbr> </span><span style="color: #000000; background-color: #efcb05; ">"host;x-amz-</span><span class="sf17b18">content-sha256;x-amz-</span><span style="color: #000000; background-color: #efcb05; ">date</span><span class="sf17b18">;x<wbr>-amz-decoded-content-length</span><span style="color: #000000; background-color: #efcb05; ">"</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln">146</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- </span><span class="sf3b2">signed_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">152</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- </span><span class="sf3b2">signed_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">147</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">148</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">154</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_canonical_headers</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_<wbr>t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_canonical_headers</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_<wbr>t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">)</span></code></td>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">152</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Add logic to remove leading and trailing spaces for header values */</span>&nbsp;</code></td>
<td class="ln">158</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Add logic to remove leading and trailing spaces for header values */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">da<wbr>ta</span><span class="sf11b2">,</span></code></td>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">da<wbr>ta</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d14" href="#d14">154</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"host:%V\nx-amz-</span><span style="color: #000000; background-color: #efcb05; ">date:%V\</span><span style="color: #000000; background-color: #efcb05; ">n"</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">160</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"host:%V\nx-amz-</span><span class="sf17b18">content-sha256:%V\nx-am<wbr>z-</span><span style="color: #000000; background-color: #efcb05; ">date:%V\</span><span class="sf17b18">nx-amz-decoded-content-length<wbr>:%V\</span><span style="color: #000000; background-color: #efcb05; ">n"</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">host</span><span class="sf11b2">,</span></code></td>
<td class="ln">161</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">host</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d15" href="#d15">156</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">x_amz_date</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
<td class="ln">162</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span class="sf17b18">x_amz_content_sha256,</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">163</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sigv4_params-&gt;</span><span style="color: #000000; background-color: #efcb05; ">x_amz_date</span><span class="sf17b18">,</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">164</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sigv4_params-&gt;x_amz_decoded_content_le<wbr>ngth</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">165</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">158</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">159</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">167</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_canonical_request</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_<wbr>t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_canonical_request</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_<wbr>t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">161</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_request</span><span class="sf11b2">)</span></code></td>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_request</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">170</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">163</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Here we assume the URI and query string have already been encoded.</span></code></td>
<td class="ln">172</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Here we assume the URI and query string have already been encoded.</span></code></td>
</tr>
<tr>
<td class="ln">165</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * &nbsp; &nbsp; &nbsp; Add encoding logic in future.</span></code></td>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; * &nbsp; &nbsp; &nbsp; Add encoding logic in future.</span></code></td>
</tr>
<tr>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf9b2"> &nbsp; */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"%V\n%V\n"</span><span class="sf11b2">,</span></code></td>
<td class="ln">175</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"%V\n%V\n"</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">method</span><span class="sf11b2">,</span></code></td>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">method</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">uri</span><span class="sf11b2">);</span></code></td>
<td class="ln">177</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">uri</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">170</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">178</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* query string can be empty */</span>&nbsp;</code></td>
<td class="ln">179</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* query string can be empty */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">172</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (!</span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">qu<wbr>ery_str</span><span class="sf11b2">))</span></code></td>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (!</span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">qu<wbr>ery_str</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2"> </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_MAX_NUM_QUERY_CO<wbr>MPONENTS</span><span class="sf11b2">];</span></code></td>
<td class="ln">182</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2"> </span><span class="sf3b2">query_params</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_MAX_NUM_QUERY_CO<wbr>MPONENTS</span><span class="sf11b2">];</span></code></td>
</tr>
<tr>
<td class="ln">175</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">query_num</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">183</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">size_t</span><span class="sf11b2"> </span><span class="sf3b2">query_num</span><span class="sf11b2"> = </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">parse_query_params</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">query<wbr>_str</span><span class="sf11b2">, </span><span class="sf3b2">query_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">query_num</span><span class="sf11b2">);</span></code></td>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">parse_query_params</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">query<wbr>_str</span><span class="sf11b2">, </span><span class="sf3b2">query_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">query_num</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">177</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">qsort</span><span class="sf11b2">(</span><span class="sf3b2">query_params</span><span class="sf11b2">, </span><span class="sf3b2">query_num</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">),</span></code></td>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">qsort</span><span class="sf11b2">(</span><span class="sf3b2">query_params</span><span class="sf11b2">, </span><span class="sf3b2">query_num</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_kv_t</span><span class="sf11b2">),</span></code></td>
</tr>
<tr>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf3b2">aws_sigv4_compare_func_t</span><span class="sf11b2">) </span><span class="sf3b2">aws_sigv4_kv_cmp</span><span class="sf11b2">);</span></code></td>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(</span><span class="sf3b2">aws_sigv4_compare_func_t</span><span class="sf11b2">) </span><span class="sf3b2">aws_sigv4_kv_cmp</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">179</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">construct_query_str</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf3b2">query_params</span><span class="sf11b2">, </span><span class="sf3b2">query_num</span><span class="sf11b2">);</span></code></td>
<td class="ln">187</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">construct_query_str</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf3b2">query_params</span><span class="sf11b2">, </span><span class="sf3b2">query_num</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">182</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">190</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">183</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">canonical_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">canonical_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_canonical_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">);</span></code></td>
<td class="ln">192</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_canonical_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">canonical_headers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">193</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">canonical_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">187</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">195</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signed_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">196</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signed_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signed_headers</span><span class="sf11b2">);</span></code></td>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signed_headers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">190</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signed_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signed_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
<td class="ln">199</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;*(</span><span class="sf3b2">str</span><span class="sf11b2">++) = </span><span class="sf12b2">'\n'</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">192</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">200</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d16" href="#d16">193</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">aws_sigv4_str_t</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b18">hex_sha256 </span><span style="color: #000000; background-color: #efcb05; ">= </span><span class="sf17b16">{ .data = </span><span style="color: #000000; background-color: #efcb05; ">str</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">};</span>&nbsp;</code></td>
<td class="ln">201</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">str</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">= </span><span class="sf17b16">aws_sigv4_sprintf(</span><span style="color: #000000; background-color: #efcb05; ">str</span><span class="sf17b18">,</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b16">"%V", </span><span style="color: #000000; background-color: #efcb05; ">&amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span class="sf17b16">x_amz_content</span><span style="color: #000000; background-color: #efcb05; ">_sha256</span><span style="color: #000000; background-color: #efcb05; ">);</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">194</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b16"> &nbsp;get_hex_sha256(</span><span style="color: #000000; background-color: #efcb05; ">&amp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span class="sf17b16">payload, &amp;hex</span><span style="color: #000000; background-color: #efcb05; ">_sha256</span><span style="color: #000000; background-color: #efcb05; ">);</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">195</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;str += hex_sha256.len;</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">196</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">202</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">203</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">canonical_request</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">199</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">200</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_string_to_sign</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">request_date</span><span class="sf11b2">,</span></code></td>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf7b2">void</span><span class="sf11b2"> </span><span class="sf8b2">get_string_to_sign</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">request_date</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">credential_scope</span><span class="sf11b2">,</span></code></td>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">credential_scope</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">202</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_request</span><span class="sf11b2">,</span></code></td>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">canonical_request</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">203</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">)</span></code></td>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2">* </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">210</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">205</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"AWS4-HMAC-SHA256\n%V\n%V\n"</span><span class="sf11b2">,</span></code></td>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"AWS4-HMAC-SHA256\n%V\n%V\n"</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">request_date</span><span class="sf11b2">, </span><span class="sf3b2">credential_scope</span><span class="sf11b2">);</span></code></td>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">request_date</span><span class="sf11b2">, </span><span class="sf3b2">credential_scope</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">208</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">214</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">hex_sha256</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">hex_sha256</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">210</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hex_sha256</span><span class="sf11b2">(</span><span class="sf3b2">canonical_request</span><span class="sf11b2">, &amp;</span><span class="sf3b2">hex_sha256</span><span class="sf11b2">);</span></code></td>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hex_sha256</span><span class="sf11b2">(</span><span class="sf3b2">canonical_request</span><span class="sf11b2">, &amp;</span><span class="sf3b2">hex_sha256</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">hex_sha256</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">hex_sha256</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">212</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">218</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">-&gt;</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">214</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">215</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">221</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_sign</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_header_t</span><span class="sf11b2">* </span><span class="sf3b2">auth_header</span><span class="sf11b2">)</span></code></td>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_sign</span><span class="sf11b2">(</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2">* </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, </span><span class="sf3b2">aws_sigv4_header_t</span><span class="sf11b2">* </span><span class="sf3b2">auth_header</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">223</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">218</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_OK</span><span class="sf11b2">;</span></code></td>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_OK</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span></code></td>
<td class="ln">225</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span></code></td>
</tr>
<tr>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf3b2">sigv4_params</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span></code></td>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf3b2">sigv4_params</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span></code></td>
</tr>
<tr>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">secr<wbr>et_access_key</span><span class="sf11b2">)</span></code></td>
<td class="ln">227</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">secr<wbr>et_access_key</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">acce<wbr>ss_key_id</span><span class="sf11b2">)</span></code></td>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">acce<wbr>ss_key_id</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">223</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">meth<wbr>od</span><span class="sf11b2">)</span></code></td>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">meth<wbr>od</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">uri</span><span class="sf11b2">)<wbr></span></code></td>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">uri</span><span class="sf11b2">)<wbr></span></code></td>
</tr>
<tr>
<td class="ln">225</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">host<wbr></span><span class="sf11b2">)</span></code></td>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">host<wbr></span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_am<wbr>z_date</span><span class="sf11b2">)</span></code></td>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_am<wbr>z_date</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">227</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">regi<wbr>on</span><span class="sf11b2">)</span></code></td>
<td class="ln">233</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">regi<wbr>on</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">serv<wbr>ice</span><span class="sf11b2">))</span></code></td>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp;|| </span><span class="sf8b2">aws_sigv4_empty_str</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">serv<wbr>ice</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">235</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_INVALID_INPUT_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_INVALID_INPUT_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">goto</span><span class="sf11b2"> </span><span class="sf3b2">err</span><span class="sf11b2">;</span></code></td>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">goto</span><span class="sf11b2"> </span><span class="sf3b2">err</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">239</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Support custom memory allocator */</span>&nbsp;</code></td>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* TODO: Support custom memory allocator */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">235</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf8b2">calloc</span><span class="sf11b2">(</span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_MAX_LEN</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">));</span></code></td>
<td class="ln">241</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf8b2">calloc</span><span class="sf11b2">(</span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_MAX_LEN</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">));</span></code></td>
</tr>
<tr>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_MEMORY_ALLOCATION_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">244</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf3b2">AWS_SIGV4_MEMORY_ALLOCATION_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">239</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">goto</span><span class="sf11b2"> </span><span class="sf3b2">err</span><span class="sf11b2">;</span></code></td>
<td class="ln">245</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">goto</span><span class="sf11b2"> </span><span class="sf3b2">err</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">246</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">241</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">247</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= (</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_NAME</span><span class="sf11b2">;</span></code></td>
<td class="ln">248</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> &nbsp;= (</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">*) </span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_NAME</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; = </span><span class="sf8b2">strlen</span><span class="sf11b2">(</span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_NAME</span><span class="sf11b2">);</span></code></td>
<td class="ln">249</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> &nbsp; = </span><span class="sf8b2">strlen</span><span class="sf11b2">(</span><span class="sf3b2">AWS_SIGV4_AUTH_HEADER_NAME</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">244</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">250</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">245</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* AWS4-HMAC-SHA256 Credential=AKIDEXAMPLE/&lt;credential_scop<wbr>e&gt; */</span>&nbsp;</code></td>
<td class="ln">251</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* AWS4-HMAC-SHA256 Credential=AKIDEXAMPLE/&lt;credential_scop<wbr>e&gt; */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">246</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* </span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">247</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"AWS4-HMAC-SHA256 Credential=%V/"</span><span class="sf11b2">,</span></code></td>
<td class="ln">253</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = &nbsp;</span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">"AWS4-HMAC-SHA256 Credential=%V/"</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">248</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
<td class="ln">254</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">249</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">255</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">250</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">credential_scope</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">credential_scope</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">251</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_credential_scope</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">);</span></code></td>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_credential_scope</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">credential_scope</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">258</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">credential_scope</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">253</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">259</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">254</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* SignedHeaders=&lt;signed_headers&gt; */</span>&nbsp;</code></td>
<td class="ln">260</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* SignedHeaders=&lt;signed_headers&gt; */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">255</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">", SignedHeaders="</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">", SignedHeaders="</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signed_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">262</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signed_headers</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signed_headers</span><span class="sf11b2">);</span></code></td>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signed_headers</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signed_headers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">258</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signed_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">264</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signed_headers</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">259</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">265</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">260</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Signature=&lt;signature&gt; */</span>&nbsp;</code></td>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Signature=&lt;signature&gt; */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">", Signature="</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
<td class="ln">267</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sprintf</span><span class="sf11b2">(</span><span class="sf3b2">str</span><span class="sf11b2">, </span><span class="sf12b2">", Signature="</span><span class="sf11b2">, &amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">access_key_id</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">262</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 1: Create a canonical request */</span>&nbsp;</code></td>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 1: Create a canonical request */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">canonical_request_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_CANONIC<wbr>AL_REQUEST_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
<td class="ln">269</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">canonical_request_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_CANONIC<wbr>AL_REQUEST_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">264</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">canonical_request</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">canonical_request_buf</span><span class="sf11b2"> };</span></code></td>
<td class="ln">270</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">canonical_request</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">canonical_request_buf</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">265</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_canonical_request</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">);</span></code></td>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_canonical_request</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 2: Create a string to sign */</span>&nbsp;</code></td>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 2: Create a string to sign */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">267</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">string_to_sign_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_STRING_TO_<wbr>SIGN_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
<td class="ln">273</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2"> </span><span class="sf3b2">string_to_sign_buf</span><span class="sf11b2">[</span><span class="sf3b2">AWS_SIGV4_STRING_TO_<wbr>SIGN_BUF_LEN</span><span class="sf11b2">] &nbsp;= { </span><span class="sf10b2">0</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">string_to_sign</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">string_to_sign_buf</span><span class="sf11b2"> };</span></code></td>
<td class="ln">274</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">string_to_sign</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">string_to_sign_buf</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">269</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_string_to_sign</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_amz<wbr>_date</span><span class="sf11b2">, &amp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">,</span></code></td>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_string_to_sign</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">-&gt;</span><span class="sf3b2">x_amz<wbr>_date</span><span class="sf11b2">, &amp;</span><span class="sf3b2">credential_scope</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">270</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">, &amp;</span><span class="sf3b2">string_to_sign</span><span class="sf11b2">);</span></code></td>
<td class="ln">276</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;</span><span class="sf3b2">canonical_request</span><span class="sf11b2">, &amp;</span><span class="sf3b2">string_to_sign</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 3: Calculate the signature */</span>&nbsp;</code></td>
<td class="ln">277</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* Task 3: Calculate the signature */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* 3.1: Derive signing key */</span>&nbsp;</code></td>
<td class="ln">278</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* 3.1: Derive signing key */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d17" href="#d17">273</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signing_key_buf</span><span style="color: #000000; background-color: #efcb05; ">[</span><span class="sf17b16">AWS_SIGV4_KEY_BUF_LEN</span><span style="color: #000000; background-color: #efcb05; ">] = { </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; "> };</span></code></td>
<td class="ln">279</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signing_key_buf</span><span style="color: #000000; background-color: #efcb05; ">[</span><span class="sf17b16">SHA256_DIGEST_LENGTH</span><span style="color: #000000; background-color: #efcb05; ">] = { </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; "> };</span></code></td>
</tr>
<tr>
<td class="ln">274</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_str_t</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; "> = { .</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">signing_key_buf</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">};</span></code></td>
<td class="ln">280</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_str_t</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signing_key</span><span style="color: #000000; background-color: #efcb05; "> = { .</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">signing_key_buf</span><span class="sf17b18">,</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b18">.len = SHA256_DIGEST_LENGTH </span><span style="color: #000000; background-color: #efcb05; ">};</span></code></td>
</tr>
<tr>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signing_key</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signing_key</span><span class="sf11b2">);</span></code></td>
<td class="ln">281</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_signing_key</span><span class="sf11b2">(</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signing_key</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">276</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* 3.2: Calculate signature on the string to sign */</span>&nbsp;</code></td>
<td class="ln">282</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* 3.2: Calculate signature on the string to sign */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d18" href="#d18">277</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signed_msg_buf</span><span style="color: #000000; background-color: #efcb05; ">[</span><span class="sf17b16">HMAC_MAX_MD_CBLOCK</span><span style="color: #000000; background-color: #efcb05; ">] = { </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; "> };</span></code></td>
<td class="ln">283</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signed_msg_buf</span><span style="color: #000000; background-color: #efcb05; ">[</span><span class="sf17b16">SHA256_DIGEST_LENGTH</span><span style="color: #000000; background-color: #efcb05; ">] = { </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; "> };</span></code></td>
</tr>
<tr>
<td class="ln">278</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_str_t</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signed_msg</span><span style="color: #000000; background-color: #efcb05; "> = { .</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">signed_msg_buf</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">};</span></code></td>
<td class="ln">284</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_str_t</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; ">signed_msg</span><span style="color: #000000; background-color: #efcb05; "> = { .</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; "> = </span><span style="color: #000000; background-color: #efcb05; ">signed_msg_buf</span><span class="sf17b18">,</span><span style="color: #000000; background-color: #efcb05; "> </span><span class="sf17b18">.len = SHA256_DIGEST_LENGTH </span><span style="color: #000000; background-color: #efcb05; ">};</span></code></td>
</tr>
<tr>
<td class="ln">279</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get HMAC SHA256 */</span>&nbsp;</code></td>
<td class="ln">285</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* get HMAC SHA256 */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a name="d19" href="#d19">280</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">HMAC</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">EVP_sha256()</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">286</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b16">mbedtls_md_hmac</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">&amp;mbedtls_sha256_info</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln">281</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">signing_key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">signing_key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">,</span></code></td>
<td class="ln">287</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">signing_key</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">signing_key</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">282</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">,</span></code></td>
<td class="ln">288</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">, </span><span class="sf3b2">string_to_sign</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d20" href="#d20">283</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signed_msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span class="sf17b18">, (unsigned int*</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18"> &amp;signed_msg.len)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">289</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">signed_msg</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">data</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">284</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signature</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
<td class="ln">290</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_str_t</span><span class="sf11b2"> </span><span class="sf3b2">signature</span><span class="sf11b2"> = { .</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> };</span></code></td>
</tr>
<tr>
<td class="ln">285</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(&amp;</span><span class="sf3b2">signed_msg</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signature</span><span class="sf11b2">);</span></code></td>
<td class="ln">291</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf8b2">get_hexdigest</span><span class="sf11b2">(&amp;</span><span class="sf3b2">signed_msg</span><span class="sf11b2">, &amp;</span><span class="sf3b2">signature</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">286</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signature</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
<td class="ln">292</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">str</span><span class="sf11b2"> += </span><span class="sf3b2">signature</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">287</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">293</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">len</span><span class="sf11b2"> = </span><span class="sf3b2">str</span><span class="sf11b2"> - </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">288</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
<td class="ln">294</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">289</td><td class="sf3b2"><code><span class="sf3b2">err</span><span class="sf11b2">:</span></code></td>
<td class="ln">295</td><td class="sf3b2"><code><span class="sf3b2">err</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln">290</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* deallocate memory in case of failure */</span>&nbsp;</code></td>
<td class="ln">296</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf9b2">/* deallocate memory in case of failure */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">291</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2"> &amp;&amp; </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">)</span></code></td>
<td class="ln">297</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header</span><span class="sf11b2"> &amp;&amp; </span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">292</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">298</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">293</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">free</span><span class="sf11b2">(</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">);</span></code></td>
<td class="ln">299</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf8b2">free</span><span class="sf11b2">(</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">294</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">NULL</span><span class="sf11b2">;</span></code></td>
<td class="ln">300</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">-&gt;</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2"> = </span><span class="sf3b2">NULL</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">295</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">301</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">296</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
<td class="ln">302</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">297</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">303</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">298</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">304</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">299</td><td class="sf3b2"><code><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_sign_with_cstr</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">secret_access_key</span><span class="sf11b2">,</span></code></td>
<td class="ln">305</td><td class="sf3b2"><code><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf8b2">aws_sigv4_sign_with_cstr</span><span class="sf11b2">(</span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">secret_access_key</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">300</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">access_key_id</span><span class="sf11b2">,</span></code></td>
<td class="ln">306</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">access_key_id</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">301</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">method</span><span class="sf11b2">,</span></code></td>
<td class="ln">307</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">method</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">302</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">uri</span><span class="sf11b2">,</span></code></td>
<td class="ln">308</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">uri</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">303</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">query_str</span><span class="sf11b2">,</span></code></td>
<td class="ln">309</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">query_str</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">304</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">host</span><span class="sf11b2">,</span></code></td>
<td class="ln">310</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">host</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d21" href="#d21">.</a></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">311</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; ">* &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">x_amz_content_sha256</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln">305</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">x_amz_date</span><span class="sf11b2">,</span></code></td>
<td class="ln">312</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">x_amz_date</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d22" href="#d22">306</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; ">* &nbsp; </span><span class="sf17b16">payload</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
<td class="ln">313</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">unsigned</span><span style="color: #000000; background-color: #efcb05; "> </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">char</span><span style="color: #000000; background-color: #efcb05; ">* &nbsp; </span><span class="sf17b16">x_amz_decoded_content_length</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln">307</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">service</span><span class="sf11b2">,</span></code></td>
<td class="ln">314</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">service</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">308</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">region</span><span class="sf11b2">,</span></code></td>
<td class="ln">315</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">* &nbsp; </span><span class="sf3b2">region</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">309</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">** &nbsp;</span><span class="sf3b2">auth_header_value</span><span class="sf11b2">)</span></code></td>
<td class="ln">316</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">unsigned</span><span class="sf11b2"> </span><span class="sf7b2">char</span><span class="sf11b2">** &nbsp;</span><span class="sf3b2">auth_header_value</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">310</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">317</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">311</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header_value</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
<td class="ln">318</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">auth_header_value</span><span class="sf11b2"> == </span><span class="sf3b2">NULL</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">312</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">319</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">313</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">AWS_SIGV4_INVALID_INPUT_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">320</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">AWS_SIGV4_INVALID_INPUT_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">314</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">321</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">315</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2"> </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">;</span></code></td>
<td class="ln">322</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_params_t</span><span class="sf11b2"> </span><span class="sf3b2">sigv4_params</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d23" href="#d23">316</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">323</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">secret_access_key</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">317</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">access_key_id</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">access_key_id</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">324</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">access_key_id</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp;</span><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">access_key_id</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">318</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">method</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">method</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">325</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">method</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">method</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">319</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">uri</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">uri</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">326</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">uri</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">uri</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">320</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">query_str</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">query_str</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">327</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">query_str</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">query_str</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">321</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">host</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">host</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">328</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">host</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">host</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">322</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">x_amz_date &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">x_amz_</span><span class="sf17b16">date</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">329</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">x_amz_content_sha256 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">x_amz_</span><span class="sf17b16">content_sha256</span><span style="color: #000000; background-color: #efcb05; ">);<wbr></span></code></td>
</tr>
<tr>
<td class="ln">323</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">payload &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">payload</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">330</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b16">x_amz_decoded_content_leng<wbr>th &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span class="sf17b16">x_amz_decoded_content_<wbr>length</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">324</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">331</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b18">x_amz_date &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = aws_sigv4_string(x_amz_date);</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">325</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
<td class="ln">332</td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18"> &nbsp;sigv4_params.</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf17b18"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">service</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln">333</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; "> &nbsp;</span><span style="color: #000000; background-color: #efcb05; ">sigv4_params</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; "> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">= </span><span style="color: #000000; background-color: #efcb05; ">aws_sigv4_string</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">region</span><span style="color: #000000; background-color: #efcb05; ">);</span></code></td>
</tr>
<tr>
<td class="ln">326</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">334</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">327</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_header_t</span><span class="sf11b2"> </span><span class="sf3b2">auth_header</span><span class="sf11b2">;</span></code></td>
<td class="ln">335</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf3b2">aws_sigv4_header_t</span><span class="sf11b2"> </span><span class="sf3b2">auth_header</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">328</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sign</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">);</span></code></td>
<td class="ln">336</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">int</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2"> = </span><span class="sf8b2">aws_sigv4_sign</span><span class="sf11b2">(&amp;</span><span class="sf3b2">sigv4_params</span><span class="sf11b2">, &amp;</span><span class="sf3b2">auth_header</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">329</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">rc</span><span class="sf11b2"> == </span><span class="sf3b2">AWS_SIGV4_OK</span><span class="sf11b2">)</span></code></td>
<td class="ln">337</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">if</span><span class="sf11b2"> (</span><span class="sf3b2">rc</span><span class="sf11b2"> == </span><span class="sf3b2">AWS_SIGV4_OK</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">330</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
<td class="ln">338</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">331</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*</span><span class="sf3b2">auth_header_value</span><span class="sf11b2"> = </span><span class="sf3b2">auth_header</span><span class="sf11b2">.</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">339</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp; &nbsp;*</span><span class="sf3b2">auth_header_value</span><span class="sf11b2"> = </span><span class="sf3b2">auth_header</span><span class="sf11b2">.</span><span class="sf3b2">value</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">332</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
<td class="ln">340</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;}</span></code></td>
</tr>
<tr>
<td class="ln">333</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
<td class="ln">341</td><td class="sf3b2"><code><span class="sf11b2"> &nbsp;</span><span class="sf7b2">return</span><span class="sf11b2"> </span><span class="sf3b2">rc</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">334</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">342</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">335</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">343</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
</tbody>
</table>
</body>
</html>
